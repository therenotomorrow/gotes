syntax = "proto3";

package api.notes.v1;

option go_package = "github.com/therenotomorrow/gotes/pkg/api/notes/v1";

import "api/types/id.proto";
import "google/protobuf/timestamp.proto";
import "buf/validate/validate.proto";

// Note represents a single note entity.
message Note {
  // Unique identifier of the note.
  api.types.ID id = 1;

  // Title of the note.
  string title = 2;

  // Content/body of the note.
  string content = 3;

  // Timestamp when the note was created.
  google.protobuf.Timestamp created_at = 4;

  // Timestamp when the note was last updated.
  google.protobuf.Timestamp updated_at = 5;
}

// ListNotesRequest is the request message for listing notes.
message ListNotesRequest {}

// ListNotesResponse is the response message containing a list of notes.
message ListNotesResponse {
  // List of notes.
  repeated Note notes = 1;
}

// RetrieveNoteRequest is the request message for fetching a single note by ID.
message RetrieveNoteRequest {
  // ID of the note to retrieve.
  api.types.ID id = 1;
}

// RetrieveNoteResponse is the response message for a single note retrieval.
message RetrieveNoteResponse {
  // The requested note.
  Note note = 1;
}

// CreateNoteRequest is the request message for creating a new note.
message CreateNoteRequest {
  // Title of the new note.
  string title = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 5,
    (buf.validate.field).string.max_len = 255
  ];

  // Content/body of the new note.
  string content = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 10
  ];
}

// CreateNoteResponse is the response message after creating a note.
message CreateNoteResponse {
  // The created note, including its generated ID and timestamps.
  Note note = 1;
}

// DeleteNoteRequest is the request message for deleting a note by ID.
message DeleteNoteRequest {
  // ID of the note to delete.
  api.types.ID id = 1;
}

// DeleteNoteResponse is the response message after deleting a note.
message DeleteNoteResponse {}

// EventType defines the type of action that occurred to a note.
enum EventType {
  // Default value, should not be used.
  EVENT_TYPE_UNKNOWN = 0;

  // Indicates that a new note has been created.
  EVENT_TYPE_CREATED = 1;

  // Indicates that a note has been deleted.
  EVENT_TYPE_DELETED = 2;
}

// Event represents a system notification about a change in notes.
message Event {
  // Unique identifier of the event.
  string id = 1;

  // Type of the event.
  EventType type = 2;

  // ID of the note associated with this event.
  api.types.ID note_id = 3;

  // Timestamp when the event occurred.
  google.protobuf.Timestamp event_time = 4;
}

// Unread represents information about the number of unread events.
message Unread {
  // Total count of unread events.
  int32 events = 1;
}

// SubscribeToEventsRequest is the request message for event stream subscription.
message SubscribeToEventsRequest {}

// SubscribeToEventsResponse is the response message in the event stream.
message SubscribeToEventsResponse {
  // The content of the subscription response.
  oneof events {
    // A specific event that just occurred.
    Event event = 1;

    // Information about unread events (e.g., sent on initial connection).
    Unread unread = 2;
  }
}
